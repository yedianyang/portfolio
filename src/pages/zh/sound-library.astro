---
import Layout from '@/layouts/Layout.astro';
import { t } from '@/i18n';

const locale = 'zh';

const timeline = [
  { year: 2025, title: '纽约 — 冬日地铁', place: 'New York' },
  { year: 2024, title: '上海片场', place: 'Shanghai' },
  { year: 2024, title: '北京胡同 — 四季', place: 'Beijing' },
  { year: 2023, title: '机器声音', place: 'NYU ITP' },
  { year: 2022, title: '夜市与雨', place: 'Seoul' },
  { year: 2021, title: '公寓拟音', place: 'Brooklyn' },
  { year: 2020, title: '海与剧场', place: 'Anaya' },
  { year: 2019, title: '录音棚素材集', place: 'BFA' },
  { year: 2019, title: '空间音频元素', place: 'Beijing' },
  { year: 2017, title: '校园生活', place: 'Beijing' },
  { year: 2015, title: '最初的录音', place: 'Home' },
];

const grouped = timeline.reduce((acc, item) => {
  const existing = acc.find(g => g.year === item.year);
  if (existing) {
    existing.items.push(item);
  } else {
    acc.push({ year: item.year, items: [item] });
  }
  return acc;
}, [] as { year: number; items: typeof timeline }[]);
---

<Layout locale={locale} title={t(locale, 'soundLibrary.title')}>
  <!-- Hero -->
  <section class="max-w-5xl mx-auto px-6 pt-24 pb-20 md:pt-32">
    <h1 class="text-5xl md:text-7xl font-extralight tracking-tight">
      {t(locale, 'soundLibrary.title')}
    </h1>
    <p class="text-base text-accent font-light mt-6 max-w-lg">
      {t(locale, 'soundLibrary.subtitle')}
    </p>
  </section>

  <!-- Timeline -->
  <section class="max-w-5xl mx-auto px-6 pb-32">
    {grouped.map((group) => (
      <div class="relative grid grid-cols-[80px_1fr] md:grid-cols-[120px_1fr] gap-0 mb-0">
        <!-- Year column -->
        <div class="relative">
          <div class="sticky top-24 text-right pr-6 md:pr-10">
            <span class="text-3xl md:text-5xl font-extralight text-gray-200">{group.year}</span>
          </div>
        </div>

        <!-- Items column -->
        <div class="border-l border-gray-100 pl-6 md:pl-10 pb-16">
          {group.items.map((item) => (
            <div class="group py-6 cursor-pointer">
              <div class="flex items-baseline gap-3">
                <h3 class="text-lg md:text-xl font-light group-hover:text-accent transition-colors duration-300">
                  {item.title}
                </h3>
                <span class="text-xs text-gray-300 font-light tracking-wider uppercase">{item.place}</span>
              </div>

              <!-- Waveform visual -->
              <div class="mt-4 flex items-end gap-[2px] h-8 opacity-30 group-hover:opacity-100 transition-opacity duration-500">
                {Array.from({ length: 60 }).map((_, i) => {
                  const h = Math.sin(i * 0.3 + group.year * 0.1) * 0.5 + 0.5;
                  const height = Math.max(8, h * 100);
                  return (
                    <div
                      class="flex-1 bg-primary rounded-full transition-all duration-300"
                      style={`height: ${height}%`}
                    />
                  );
                })}
              </div>

              <!-- Hover reveal: play hint -->
              <div class="mt-3 flex items-center gap-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <div class="flex items-center gap-2 text-xs text-accent">
                  <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z" />
                  </svg>
                  <span>{t(locale, 'soundLibrary.comingSoon')}</span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    ))}
  </section>
</Layout>
