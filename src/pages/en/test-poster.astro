---
import Layout from '@/layouts/Layout.astro';
import { t, getLocalePath } from '@/i18n';
import { getCollection } from 'astro:content';

const locale = 'en';
const projects = await getCollection('projects', ({ data, id }) => {
  return id.startsWith('en/') && data.featured;
});
const sorted = projects.sort((a, b) => (a.data.order || 0) - (b.data.order || 0));

// Color placeholders for projects without thumbnails
const placeholderColors = [
  'bg-stone-800', 'bg-zinc-700', 'bg-neutral-800', 'bg-gray-700',
  'bg-stone-700', 'bg-zinc-800', 'bg-neutral-700', 'bg-gray-800',
];
---

<Layout locale={locale} title="Test — Poster 2:3">
  <!-- Hero -->
  <section class="max-w-6xl mx-auto px-6 pt-24 pb-16 md:pt-32 md:pb-24">
    <h1 class="text-4xl md:text-6xl font-light tracking-tight leading-tight">
      {t(locale, 'home.name')}
    </h1>
    <p class="text-lg md:text-xl text-accent mt-4 max-w-2xl">
      {t(locale, 'home.tagline')}
    </p>
    <p class="text-xs text-red-400 mt-2 uppercase tracking-widest">Test layout: Poster 2:3</p>
  </section>

  <!-- Featured Projects — 2:3 Poster Grid -->
  <section class="max-w-6xl mx-auto px-6 pb-20">
    <h2 class="text-sm font-medium uppercase tracking-widest text-accent mb-8">
      {t(locale, 'home.featured')}
    </h2>
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      {sorted.map((project, i) => (
        <a href={getLocalePath(locale, `projects/${project.slug.replace('en/', '')}`)} class="group block">
          <div class={`aspect-[2/3] overflow-hidden mb-3 ${project.data.thumbnail ? 'bg-gray-100' : placeholderColors[i % placeholderColors.length]}`}>
            {project.data.thumbnail ? (
              <img
                src={project.data.thumbnail}
                alt={project.data.title}
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                loading="lazy"
              />
            ) : (
              <div class="w-full h-full flex items-end p-4">
                <span class="text-white/60 text-xs font-light">{project.data.title}</span>
              </div>
            )}
          </div>
          <h3 class="text-sm font-medium group-hover:opacity-70 transition-opacity leading-tight">{project.data.title}</h3>
          <p class="text-xs text-accent mt-1">
            {[project.data.role, project.data.year].filter(Boolean).join(' — ')}
          </p>
        </a>
      ))}
    </div>
  </section>
</Layout>
